[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "event_frequency": "All",
  "modified": "2024-05-24 15:39:21.365648",
  "module": null,
  "name": "Workflow Automation Leaves",
  "reference_doctype": "Employee",
  "script": "\nif doc.custom_leave_recommendation:\n    if not frappe.db.exists(\"Leave Recommendation\", {\"employee_id\": doc.name}):\n        lr_doc = frappe.new_doc(\"Leave Recommendation\")\n        lr_doc.employee_id = doc.name\n        lr_doc.user_id = doc.custom_leave_recommendation\n        lr_doc.role = \"Leave Recommendation - \" + str(doc.name)[7:]\n        \n        lr_doc.insert()\n        # lr_doc.save()\n\n        role_rec_doc = frappe.new_doc(\"Role\")\n        role_rec_doc.role_name = \"Leave Recommendation - \" + str(doc.name)[7:]\n\n        role_rec_doc.insert()\n        # role_rec_doc.save()\n\n        workflow_doc = frappe.get_doc(\"Workflow\", \"Leave Approval Process\")\n\n        workflow_doc.append(\"transitions\",{\n            \"state\": \"Pending for Leave recommendation approval\",\n            \"action\": \"Approve\",\n            \"next_state\": \"Pending for Leave approval\",\n            \"allowed\": \"Leave Recommendation - \" + str(doc.name)[7:],\n            \"condition\": f\"doc.custom_leave_recommendation == \\\"{doc.custom_leave_recommendation}\\\"\"\n        })\n\n        workflow_doc.append(\"transitions\",{\n            \"state\": \"Pending for Leave recommendation approval\",\n            \"action\": \"Reject\",\n            \"next_state\": \"Rejected by Leave recommendation\",\n            \"allowed\": \"Leave Recommendation - \" + str(doc.name)[7:],\n            \"condition\": f\"doc.custom_leave_recommendation == \\\"{doc.custom_leave_recommendation}\\\"\"\n        })\n\n        workflow_doc.save()\n        frappe.msgprint(f\"<strong>Leave Recommendation - {str(doc.name)[7:]}</strong>Role assigned to <strong>{doc.name}</strong>\")\n    else:\n        if not doc.leave_approver:\n            frappe.throw(f\"Role already assigned to <strong>{doc.name} </strong> in Leave Recommendation\")\nif doc.leave_approver:\n    if not frappe.db.exists(\"Leave Approval\", {\"employee_id\": doc.name}):\n        la_doc = frappe.new_doc(\"Leave Approval\")\n        la_doc.employee_id = doc.name\n        la_doc.user_id = doc.leave_approver\n        la_doc.role = \"Leave Approval - \" + str(doc.name)[7:]\n\n        la_doc.insert()\n        # la_doc.save()\n\n        role_apr_doc = frappe.new_doc(\"Role\")\n        role_apr_doc.role_name = \"Leave Approval - \" + str(doc.name)[7:]\n\n        role_apr_doc.insert()\n        # role_apr_doc.save()\n        \n        workflow_doc = frappe.get_doc(\"Workflow\", \"Leave Approval Process\")\n\n        workflow_doc.append(\"transitions\",{\n            \"state\": \"Pending for Leave approval\",\n            \"action\": \"Approve\",\n            \"next_state\": \"Approved\",\n            \"allowed\": \"Leave Approval - \" + str(doc.name)[7:],\n            \"condition\": f\"doc.leave_approver == \\\"{doc.leave_approver}\\\"\"\n        })\n\n        workflow_doc.append(\"transitions\",{\n            \"state\": \"Pending for Leave approval\",\n            \"action\": \"Reject\",\n            \"next_state\": \"Rejected\",\n            \"allowed\": \"Leave Approval - \" + str(doc.name)[7:],\n            \"condition\": f\"doc.leave_approver == \\\"{doc.leave_approver}\\\"\"\n        })\n\n        workflow_doc.save()\n        frappe.msgprint(f\"<strong>Leave Approval - {str(doc.name)[7:]}</strong> Role assigned to <strong>{doc.name}</strong>\")\n    else:\n        if not doc.custom_leave_recommendation:\n            frappe.throw(f\"Role already assigned to <strong>{doc.name}</strong> in Leave Approval\")\n        \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n",
  "script_type": "DocType Event"
 }
]